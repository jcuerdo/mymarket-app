<ion-header>

  <ion-navbar>
    <ion-title>{{"Details of" | translate}} : {{market.name}}</ion-title>
  </ion-navbar>

</ion-header>


<ion-content>
  <div>
    <ion-segment [(ngModel)]="tab">
      <ion-segment-button value="info">{{"Info" | translate}}</ion-segment-button>
      <ion-segment-button (click)="loadComments()" value="comments">{{"Comments" | translate}}</ion-segment-button>
      <ion-segment-button (click)="loadAssistance()" value="assistance">{{"Assistance" | translate}}</ion-segment-button>
    </ion-segment>
  </div>
  
  <div [ngSwitch]="tab" >
    <ion-list *ngIf="tab=='info'" ngSelected="selected">
      <ion-card>
        <ion-slides zoom="true" pager="true" zoom="true">
          <ion-slide *ngFor="let photo of this.market.photos" class="marketImage">
            <img src='{{photo.getContent()}}' />
          </ion-slide>
        </ion-slides>
        <ion-card-content>
          <ion-card-title>
            <h2>{{ market.name }}</h2>
          </ion-card-title>
          <p  *ngIf='market.place == "PUBLIC" && market.googlePlaceId'>  <ion-icon name="globe"></ion-icon>
            <a href="https://www.google.com/maps/search/?api=1&query=Google&query_place_id={{market.googlePlaceId}}">{{ "Market url" | translate }}</a>
          </p>
          <ion-icon *ngIf='market.place != "PUBLIC"' name="calendar"></ion-icon>
          <span *ngIf='market.place != "PUBLIC"'>{{market.date | date:'dd-MM-yyyy hh:mm'}}</span>
    
          <p>{{ market.description }} </p>

          <ion-item class="clickable" *ngIf='market.owner'>
              <h2>{{ "Created by" | translate }}</h2>
            <ion-avatar item-start>
                <img  src="{{ market.owner.photo }}" (click)="viewUser(market.owner.id)"/>
            </ion-avatar>
            <h3>{{ market.owner.fullname }} <em>{{ market.owner.email }}</em></h3>
          </ion-item>

          <p *ngIf='market.type == "FREE"'>  <ion-icon name="card"></ion-icon>
             {{ "Free market" | translate }}</p>
          <p *ngIf='market.type == "PAY"'>  <ion-icon name="card"></ion-icon>
             {{ "Pay market" | translate }}</p>
          <p *ngIf='market.type == "MIXED"'>  <ion-icon name="card"></ion-icon>
             {{ "Mixed market free and payed items" | translate }}</p>
          <p *ngIf='market.type == "PUBLIC"'>  <ion-icon name="card"></ion-icon>
            {{ "Pay market" | translate }}</p>

          <p *ngIf='market.place == "INDOOR"'>  <ion-icon name="globe"></ion-icon>
             {{ "Indor market" | translate }}</p>
          <p *ngIf='market.place == "OUTDOOR"'>  <ion-icon name="home"></ion-icon>
             {{ "Outdoor market" | translate }}</p>
          <p *ngIf='market.place == "PUBLIC"'>  <ion-icon name="flower"></ion-icon>
              {{ "Public market" | translate }}</p>

        </ion-card-content>
      </ion-card>
   </ion-list>
<ion-list *ngIf="tab=='comments'">
  <ion-card>
    <ion-card-content>
      <ion-card-title>
        <h2>{{ "Comments" | translate }}</h2>
      </ion-card-title>
      <div *ngIf="this.userProvider.getCurrentUserId() > 0">
      <ion-item>
          <ion-input required [(ngModel)]="commentContent" placeholder='{{"Your comment" | translate}}' type="text"></ion-input>
        </ion-item>
        <button ion-button (click)="addComment()">{{"Comment" | translate}}</button>
      </div>
        <ion-list *ngFor="let comment of comments">
            <ion-item>
              <ion-avatar item-start>
                  <img  src="{{ comment.user.photo.String }}"/>
              </ion-avatar>
              <h2>{{ comment.user.fullname.String }} <em>{{ comment.user.email }}</em></h2>
              <p>{{ comment.date }} : {{ comment.content }}</p>
              <button *ngIf="this.userProvider.getCurrentUserId() == comment.user.id" (click)="removeComment(comment.id)">
                <ion-icon name="trash"></ion-icon>
              </button>
            </ion-item>
          </ion-list>
    </ion-card-content>
  </ion-card>
</ion-list>
  <ion-list *ngIf="tab=='assistance'">
  <ion-card>
    <ion-card-content>
      <ion-card-title>
        <h2>{{ "Assistance list" | translate }}</h2>
        <div *ngIf="this.userProvider.getCurrentUserId() > 0">
        <button ion-button (click)="addAssistance()">{{"Assist" | translate}}</button>
        </div>
      </ion-card-title>
      <ion-list *ngFor="let assistance of assistances">
          <ion-item>
            <ion-avatar item-start>
                <img  src="{{ assistance.user_id.photo.String }}"/>
            </ion-avatar>
            <h2>{{ assistance.user_id.fullname.String }} <em>{{ assistance.user_id.email }}</em></h2>
            <p>{{ assistance.date }}</p> 
            <button *ngIf="this.userProvider.getCurrentUserId() == assistance.user_id.id" (click)="removeAssistance(assistance.id)">
              <ion-icon name="trash"></ion-icon>
            </button>
          </ion-item>
        </ion-list>
    </ion-card-content>
  </ion-card>
   </ion-list>
</div>
    <div id="map"></div>
</ion-content>